# Docker Compose構成ファイル - ブロックチェーンノードネットワーク
#
# 使い方:
# 1. 起動: docker compose up -d
# 2. コンテナでコマンド実行: docker exec -it <container_name> <command>
#    例: docker exec -it node2 sh -c "./zig-out/bin/block_client node1 3000 'Hello'"
#
# 注意: 新しいコンテナを起動するには docker compose run ではなく docker exec を使用してください

services:
  node1:
    build: .
    platform: linux/amd64
    container_name: node1
    ports:
      - "3001:3000"
    environment:
      - NODE_ID=1
    command: sh -c "./zig-out/bin/chapter7 --listen 3000"
    volumes:
      - ./:/app

  node2:
    build: .
    platform: linux/amd64
    container_name: node2
    ports:
      - "3002:3000"
    environment:
      - NODE_ID=2
    command: sh -c "./zig-out/bin/chapter7 --listen 3000 --connect node1:3000"
    volumes:
      - ./:/app

  node3:
    build: .
    platform: linux/amd64
    container_name: node3
    ports:
      - "3003:3000"
    environment:
      - NODE_ID=3
    command: sh -c "./zig-out/bin/chapter7 --listen 3000 --connect node1:3000"
    volumes:
      - ./:/app
